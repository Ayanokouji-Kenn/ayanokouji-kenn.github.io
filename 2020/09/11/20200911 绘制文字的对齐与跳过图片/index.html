<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>绘制文字的对齐与跳过图片 | 七夜的小屋</title><meta name="description" content="绘制空心圆stroke问题stroke并不是在圆的半径外面，再往外绘制一个圆，而是就在圆周处绘制，绘制粗细等于paint.strokeWidth 1234567891011121314151617181920212223242526272829303132class CircleView(context: Context?, attrs: AttributeSet?) : View(context"><meta name="keywords" content="Android,View,canvas"><meta name="author" content="Nanaya Haruki"><meta name="copyright" content="Nanaya Haruki"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/avatar.jfif"><link rel="canonical" href="https://nanayaharuki.github.io/2020/09/11/20200911%20%E7%BB%98%E5%88%B6%E6%96%87%E5%AD%97%E7%9A%84%E5%AF%B9%E9%BD%90%E4%B8%8E%E8%B7%B3%E8%BF%87%E5%9B%BE%E7%89%87/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin="crossorigin"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="bVhNojYvumg92cuWQHIpPCLKkDNieuXJCoUG8Kpmxzg"/><meta name="baidu-site-verification" content="H4PZQqcpUQ"/><meta property="og:type" content="article"><meta property="og:title" content="绘制文字的对齐与跳过图片"><meta property="og:url" content="https://nanayaharuki.github.io/2020/09/11/20200911%20%E7%BB%98%E5%88%B6%E6%96%87%E5%AD%97%E7%9A%84%E5%AF%B9%E9%BD%90%E4%B8%8E%E8%B7%B3%E8%BF%87%E5%9B%BE%E7%89%87/"><meta property="og:site_name" content="七夜的小屋"><meta property="og:description" content="绘制空心圆stroke问题stroke并不是在圆的半径外面，再往外绘制一个圆，而是就在圆周处绘制，绘制粗细等于paint.strokeWidth 1234567891011121314151617181920212223242526272829303132class CircleView(context: Context?, attrs: AttributeSet?) : View(context"><meta property="og:image" content="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg"><meta property="article:published_time" content="2020-09-11T02:04:27.000Z"><meta property="article:modified_time" content="2021-03-10T09:35:59.011Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="20210310 flutter web 页面空白 canvaskit" href="https://nanayaharuki.github.io/2021/03/10/20210310%20flutter%20web%20%E9%A1%B5%E9%9D%A2%E7%A9%BA%E7%99%BD%20canvaskit/"><link rel="next" title="ObjectBox增加新字段的问题" href="https://nanayaharuki.github.io/2020/07/24/20200724%20ObjectBox%E5%A2%9E%E5%8A%A0%E6%96%B0%E5%AD%97%E6%AE%B5%E7%9A%84%E9%97%AE%E9%A2%98/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4417f86c0cc24eb9d60f23fc6cbaa820";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-85987364-1', 'auto');
ga('send', 'pageview');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jfif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">91</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">30</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">3</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-6"><a class="toc-link" href="#绘制空心圆stroke问题"><span class="toc-number">1.</span> <span class="toc-text">绘制空心圆stroke问题</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#绘制文字纵向居中和左对齐"><span class="toc-number"></span> <span class="toc-text">绘制文字纵向居中和左对齐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#绘制文字跳过图片"><span class="toc-number"></span> <span class="toc-text">绘制文字跳过图片</span></a></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">七夜的小屋</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">绘制文字的对齐与跳过图片</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-09-11 10:04:27"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-09-11</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-03-10 17:35:59"><i class="fas fa-history fa-fw"></i> 更新于 2021-03-10</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/Android/">Android</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">1.1k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 5 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h6 id="绘制空心圆stroke问题"><a href="#绘制空心圆stroke问题" class="headerlink" title="绘制空心圆stroke问题"></a>绘制空心圆stroke问题</h6><p>stroke并不是在圆的半径外面，再往外绘制一个圆，而是就在圆周处绘制，绘制粗细等于<code>paint.strokeWidth</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CircleView</span></span>(context: Context?, attrs: AttributeSet?) : View(context, attrs) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> paint = Paint(Paint.ANTI_ALIAS_FLAG)</span><br><span class="line">    <span class="keyword">val</span> RADIUS = <span class="number">150F</span>.dp</span><br><span class="line">    <span class="keyword">var</span> centerX = <span class="number">0f</span></span><br><span class="line">    <span class="keyword">var</span> centerY = <span class="number">0f</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSizeChanged</span><span class="params">(w: <span class="type">Int</span>, h: <span class="type">Int</span>, oldw: <span class="type">Int</span>, oldh: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onSizeChanged(w, h, oldw, oldh)</span><br><span class="line">        centerX = w/<span class="number">2f</span></span><br><span class="line">        centerY = h/<span class="number">2f</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas)</span><br><span class="line">        <span class="comment">// 描个灰色的边，宽15dp</span></span><br><span class="line">        paint.color = Color.LTGRAY</span><br><span class="line">        paint.strokeWidth = <span class="number">15f</span>.dp</span><br><span class="line">        paint.style = Paint.Style.STROKE</span><br><span class="line">        canvas.drawCircle(centerX,centerY,RADIUS,paint)</span><br><span class="line">        <span class="comment">// 描个青色的边，宽8dp</span></span><br><span class="line">        paint.color = Color.CYAN</span><br><span class="line">        paint.strokeCap = Paint.Cap.ROUND</span><br><span class="line">        paint.strokeWidth = <span class="number">8f</span>.dp</span><br><span class="line">        canvas.drawCircle(centerX,centerY,RADIUS,paint)</span><br><span class="line">        <span class="comment">// 在圆周画2条竖线，表示圆周在哪</span></span><br><span class="line">        paint.strokeWidth = <span class="number">1f</span></span><br><span class="line">        paint.color = Color.RED</span><br><span class="line">        canvas.drawLine(centerX-RADIUS,<span class="number">0f</span>,centerX-RADIUS,<span class="number">1000f</span>,paint)</span><br><span class="line">        canvas.drawLine(centerX+RADIUS,<span class="number">0f</span>,centerX+RADIUS,<span class="number">1000f</span>,paint)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/09/11/Vu5otkOwPThyd39.png" alt="1.png"></p>
<p>可以看到，stroke并不是在圆的<strong>外面</strong>绘制，而是就在圆周处绘制，15的宽度会是圆外画7，圆内画7。<br>顺便画圆也可以用drawArc和drawOval来实现。</p>
<hr>
<p>进入正题</p>
<h3 id="绘制文字纵向居中和左对齐"><a href="#绘制文字纵向居中和左对齐" class="headerlink" title="绘制文字纵向居中和左对齐"></a>绘制文字纵向居中和左对齐</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CircleView</span></span>(context: Context?, attrs: AttributeSet?) : View(context, attrs) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> paint = Paint(Paint.ANTI_ALIAS_FLAG).apply &#123;</span><br><span class="line">        style = Paint.Style.STROKE</span><br><span class="line">        strokeCap = Paint.Cap.ROUND</span><br><span class="line"></span><br><span class="line">        strokeWidth = <span class="number">15f</span>.dp</span><br><span class="line">        textSize = <span class="number">34f</span>.dp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> RADIUS = <span class="number">150F</span>.dp</span><br><span class="line">    <span class="keyword">var</span> centerX = <span class="number">0f</span></span><br><span class="line">    <span class="keyword">var</span> centerY = <span class="number">0f</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSizeChanged</span><span class="params">(w: <span class="type">Int</span>, h: <span class="type">Int</span>, oldw: <span class="type">Int</span>, oldh: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onSizeChanged(w, h, oldw, oldh)</span><br><span class="line">        centerX = w / <span class="number">2f</span></span><br><span class="line">        centerY = h / <span class="number">2f</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> testStr = <span class="string">"abab"</span></span><br><span class="line">    <span class="keyword">val</span> textBound = Rect()</span><br><span class="line">    <span class="keyword">val</span> fontMetrics = Paint.FontMetricsInt()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas)</span><br><span class="line"></span><br><span class="line">        paint.color = Color.LTGRAY</span><br><span class="line">        canvas.drawArc(</span><br><span class="line">            centerX - RADIUS,</span><br><span class="line">            centerY - RADIUS,</span><br><span class="line">            centerX + RADIUS,</span><br><span class="line">            centerY + RADIUS,</span><br><span class="line">            -<span class="number">90f</span>,</span><br><span class="line">            <span class="number">360f</span>,</span><br><span class="line">            <span class="literal">false</span>,</span><br><span class="line">            paint</span><br><span class="line">        )</span><br><span class="line">        paint.color = Color.BLUE</span><br><span class="line">        canvas.drawArc(</span><br><span class="line">            centerX - RADIUS,</span><br><span class="line">            centerY - RADIUS,</span><br><span class="line">            centerX + RADIUS,</span><br><span class="line">            centerY + RADIUS,</span><br><span class="line">            -<span class="number">90f</span>,</span><br><span class="line">            <span class="number">250f</span>,</span><br><span class="line">            <span class="literal">false</span>,</span><br><span class="line">            paint</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">// 画个圆心，定个位置，方便比较文字的纵向坐标</span></span><br><span class="line">        paint.strokeWidth = <span class="number">5f</span>.dp</span><br><span class="line">        canvas.drawPoint(centerX, centerY, paint)</span><br><span class="line">        paint.strokeWidth = <span class="number">0f</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ————————————————————— 下面为调整文字居中对齐的2种方式 ———————————————————————</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方法一、静态文字，可以直接测量高度,这是从[1,0]开始测量的，top为负数</span></span><br><span class="line">        <span class="comment">// [2,-39][112,1]</span></span><br><span class="line">        paint.getTextBounds(testStr, <span class="number">0</span>, testStr.length, textBound)</span><br><span class="line">        canvas.drawText(</span><br><span class="line">            testStr,</span><br><span class="line">            centerX - (textBound.right + textBound.left) / <span class="number">2</span>,</span><br><span class="line">            centerY - (textBound.top + textBound.bottom) / <span class="number">2</span>,</span><br><span class="line">            paint</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">// 方法二、动态文字，可以用文字五条定位线中的top~bottom （包含留白）或 ascent ~ descent（文字主体部分）</span></span><br><span class="line">        <span class="comment">// FontMetricsInt: top=-54 ascent=-47 descent=12 bottom=14 leading=0</span></span><br><span class="line">        <span class="comment">// 和textBound一样，这玩意也是top负数</span></span><br><span class="line">        paint.getFontMetricsInt(fontMetrics)</span><br><span class="line">        Log.d(javaClass.simpleName,fontMetrics.toString())</span><br><span class="line">        canvas.drawText(</span><br><span class="line">            testStr, centerX - (textBound.right + textBound.left) / <span class="number">2</span>,</span><br><span class="line">            centerY - (fontMetrics.top + fontMetrics.bottom) / <span class="number">2</span>,</span><br><span class="line">            paint</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ————————————————————— 下面为调整文字左对齐 ———————————————————————</span></span><br><span class="line">        <span class="comment">// 横坐标为0的话，如果2行的字体大小差距很大，依然不会对齐，因为每个字符有自然间距</span></span><br><span class="line">        <span class="comment">// 通过textBound.left进行调整后，基本就对齐了，但还是会差几个像素，这是系统问题，没法解决</span></span><br><span class="line">        paint.color = Color.BLACK</span><br><span class="line">        paint.textSize = <span class="number">14f</span>.dp</span><br><span class="line">        paint.getTextBounds(testStr,<span class="number">0</span>,testStr.length,textBound)</span><br><span class="line">        canvas.drawText(testStr, -textBound.left.toFloat(),-textBound.top.toFloat(), paint)</span><br><span class="line"></span><br><span class="line">        paint.textSize = <span class="number">150f</span>.dp</span><br><span class="line">        paint.getTextBounds(testStr,<span class="number">0</span>,testStr.length,textBound)</span><br><span class="line">        canvas.drawText(testStr,  -textBound.left.toFloat(),-textBound.top.toFloat(), paint)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="绘制文字跳过图片"><a href="#绘制文字跳过图片" class="headerlink" title="绘制文字跳过图片"></a>绘制文字跳过图片</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiTextView</span></span>(context: Context?, attrs: AttributeSet?) : View(context, attrs) &#123;</span><br><span class="line">    <span class="keyword">val</span> testStr =</span><br><span class="line">        <span class="string">"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et turpis tortor. Sed efficitur arcu tellus, vitae elementum ante bibendum in. Proin id tortor sapien. Donec sit amet dictum elit. Nam bibendum quam elit, vel malesuada dolor rhoncus sit amet. Aliquam congue finibus dui, ut finibus tellus sollicitudin vitae. Aliquam finibus felis sed imperdiet viverra. Phasellus id lorem justo. Donec vehicula a augue at lacinia. Etiam tincidunt eros sed euismod aliquam.\n"</span> +</span><br><span class="line">                <span class="string">"In hac habitasse platea dictumst. Ut tempor maximus mauris et semper. In facilisis, augue sit amet imperdiet porttitor, turpis sapien pharetra quam, vitae porta neque ligula nec ligula. Sed sed elit erat. Praesent viverra dui ac velit pretium, non volutpat nisi euismod. Praesent at condimentum felis, ut convallis augue. Nam ut velit eros. Curabitur tristique, nisl eget porta pretium, justo quam mollis nisi, at posuere orci dolor eu enim. Integer ac dui vitae tellus vestibulum egestas. Sed congue vitae elit ac posuere. Pellentesque ut risus id nibh porttitor consequat ut luctus neque. Duis a lectus facilisis, eleifend massa a, lobortis libero."</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> paint = Paint(Paint.ANTI_ALIAS_FLAG)</span><br><span class="line">    <span class="keyword">val</span> bmpWidth = <span class="number">200f</span>.dp.toInt()</span><br><span class="line">    <span class="keyword">val</span> bmpTopPadding = <span class="number">100</span></span><br><span class="line">    <span class="keyword">val</span> options = BitmapFactory.Options()</span><br><span class="line">    <span class="keyword">val</span> fontMetrics = Paint.FontMetricsInt()</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> bmp: Bitmap</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSizeChanged</span><span class="params">(w: <span class="type">Int</span>, h: <span class="type">Int</span>, oldw: <span class="type">Int</span>, oldh: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onSizeChanged(w, h, oldw, oldh)</span><br><span class="line"></span><br><span class="line">        options.inJustDecodeBounds = <span class="literal">true</span> <span class="comment">// 不实际读取像素，只测量大小，几乎不消耗时间和空间</span></span><br><span class="line">        BitmapFactory.decodeResource(resources, R.drawable.kana, options)</span><br><span class="line">        options.inJustDecodeBounds = <span class="literal">false</span></span><br><span class="line">        options.inDensity = options.outWidth</span><br><span class="line">        options.inTargetDensity = bmpWidth</span><br><span class="line">        bmp = BitmapFactory.decodeResource(resources, R.drawable.kana, options)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绘制图片 图片在[onSizeChanged]中初始化了</span></span><br><span class="line">        canvas.drawBitmap(bmp, width.toFloat() - bmpWidth, bmpTopPadding.toFloat(), paint)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绘制文字,绕过图片</span></span><br><span class="line">        paint.textSize = <span class="number">20f</span>.dp</span><br><span class="line">        paint.getFontMetricsInt(fontMetrics)</span><br><span class="line">        <span class="keyword">var</span> start = <span class="number">0</span></span><br><span class="line">        <span class="keyword">var</span> verticalOffset = -fontMetrics.top <span class="comment">//纵向初始偏移量</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt; testStr.length) &#123;</span><br><span class="line">            <span class="keyword">var</span> maxWidth =</span><br><span class="line">                <span class="keyword">if</span> (verticalOffset + fontMetrics.bottom &lt; bmpTopPadding</span><br><span class="line">                    || verticalOffset + fontMetrics.top &gt; bmpTopPadding + bmp.height</span><br><span class="line">                ) &#123;</span><br><span class="line">                    width</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    width - bmpWidth</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">val</span> count =</span><br><span class="line">                paint.breakText(testStr, start, testStr.length, <span class="literal">true</span>, maxWidth.toFloat(), <span class="literal">null</span>)</span><br><span class="line">            canvas.drawText(testStr, start, start + count, <span class="number">0f</span>, verticalOffset.toFloat(), paint)</span><br><span class="line">            start += count</span><br><span class="line">            <span class="comment">//fontSpacing是基于字体和textSize定下的一行所占空间</span></span><br><span class="line">            verticalOffset += paint.fontSpacing.toInt()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/09/11/fyR3sdtn4K5juFe.png" alt="2.png"></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Nanaya Haruki</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://nanayaharuki.github.io/2020/09/11/20200911%20%E7%BB%98%E5%88%B6%E6%96%87%E5%AD%97%E7%9A%84%E5%AF%B9%E9%BD%90%E4%B8%8E%E8%B7%B3%E8%BF%87%E5%9B%BE%E7%89%87/">https://nanayaharuki.github.io/2020/09/11/20200911%20%E7%BB%98%E5%88%B6%E6%96%87%E5%AD%97%E7%9A%84%E5%AF%B9%E9%BD%90%E4%B8%8E%E8%B7%B3%E8%BF%87%E5%9B%BE%E7%89%87/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://nanayaharuki.github.io" target="_blank">七夜的小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/View/">View</a><a class="post-meta__tags" href="/tags/canvas/">canvas</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/03/10/20210310%20flutter%20web%20%E9%A1%B5%E9%9D%A2%E7%A9%BA%E7%99%BD%20canvaskit/"><img class="prev-cover" data-src="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">20210310 flutter web 页面空白 canvaskit</div></div></a></div><div class="next-post pull-right"><a href="/2020/07/24/20200724%20ObjectBox%E5%A2%9E%E5%8A%A0%E6%96%B0%E5%AD%97%E6%AE%B5%E7%9A%84%E9%97%AE%E9%A2%98/"><img class="next-cover" data-src="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ObjectBox增加新字段的问题</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2016/12/05/20161205 一个方便做轮播图的工具/" title="一个方便做轮播图的工具"><img class="relatedPosts_cover" data-src="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2016-12-05</div><div class="relatedPosts_title">一个方便做轮播图的工具</div></div></a></div><div class="relatedPosts_item"><a href="/2016/12/06/20161206 滑动回弹与内层listview的滑动冲突/" title="滑动回弹与内层listview的滑动冲突"><img class="relatedPosts_cover" data-src="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2016-12-06</div><div class="relatedPosts_title">滑动回弹与内层listview的滑动冲突</div></div></a></div><div class="relatedPosts_item"><a href="/2017/06/27/20170627 AlertDialog不显示文字/" title="AlertDialog不显示文字"><img class="relatedPosts_cover" data-src="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-06-27</div><div class="relatedPosts_title">AlertDialog不显示文字</div></div></a></div><div class="relatedPosts_item"><a href="/2017/07/05/20170705 打开相册失败no activity found/" title="打开相册失败no activity found"><img class="relatedPosts_cover" data-src="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-07-05</div><div class="relatedPosts_title">打开相册失败no activity found</div></div></a></div><div class="relatedPosts_item"><a href="/2017/07/14/20170714 给软键盘加上一个插件布局/" title="给软键盘加上一个插件布局"><img class="relatedPosts_cover" data-src="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-07-14</div><div class="relatedPosts_title">给软键盘加上一个插件布局</div></div></a></div><div class="relatedPosts_item"><a href="/2017/07/18/20170718 gravity=center_vertical与centerVertcal=true的区别/" title="gravity=center_vertical与centerVertcal=true的区别"><img class="relatedPosts_cover" data-src="https://w.wallhaven.cc/full/j5/wallhaven-j5zprq.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-07-18</div><div class="relatedPosts_title">gravity=center_vertical与centerVertcal=true的区别</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Nanaya Haruki</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script></body></html>